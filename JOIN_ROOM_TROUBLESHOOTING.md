# دليل استكشاف أخطاء الانضمام للغرفة وإصلاحها

## المشكلة الأساسية
عندما يضغط المستخدم على زر "انضمام"، لا يستطيع الدخول إلى الغرفة.

## 🔧 أدوات التشخيص المتوفرة

### 1. التشخيص السريع من التطبيق
- اذهب إلى الشاشة الرئيسية للعب الأونلاين
- اضغط على زر "تشخيص سريع" (الزر الأزرق)
- ستظهر لك نافذة تحتوي على:
  - حالة اتصال Firebase
  - حالة اتصال Firestore
  - عدد الغرف المتاحة
  - اختبار إنشاء غرفة تجريبية

### 2. التشخيص من سطر الأوامر
```bash
# تشغيل التشخيص السريع
dart quick_diagnostic.dart

# تشغيل اختبارات شاملة
dart test_join_room.dart diagnostic
```

## 🔍 الأخطاء الشائعة وحلولها

### 1. خطأ الأذونات (Permission Denied)
**الرسالة:** `permission-denied`
**السبب:** قواعد Firestore لا تسمح بالقراءة/الكتابة
**الحل:**
```javascript
// في Firebase Console > Firestore > Rules
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true; // للتطوير فقط
    }
  }
}
```

### 2. مشكلة الشبكة
**الرسالة:** `network error`
**السبب:** عدم وجود اتصال بالإنترنت أو مشاكل في الشبكة
**الحل:**
- تحقق من اتصال الإنترنت
- جرب إعادة تشغيل الراوتر
- استخدم شبكة أخرى

### 3. الغرفة غير موجودة
**الرسالة:** `الغرفة غير موجودة`
**السبب:** كود الغرفة خاطئ أو الغرفة تم حذفها
**الحل:**
- تأكد من صحة كود الغرفة (6 أرقام)
- اضغط على "الغرف المتاحة" لرؤية الغرف الموجودة
- جرب إنشاء غرفة جديدة

### 4. الغرفة ممتلئة
**الرسالة:** `الغرفة ممتلئة`
**السبب:** الغرفة وصلت للحد الأقصى من اللاعبين
**الحل:**
- ابحث عن غرفة أخرى
- انتظر حتى يخرج أحد اللاعبين
- أنشئ غرفة جديدة

### 5. حالة الغرفة غير صحيحة
**الرسالة:** `الغرفة ليست في حالة انتظار`
**السبب:** الغرفة بدأت اللعب أو انتهت
**الحل:**
- ابحث عن غرف في حالة انتظار
- أنشئ غرفة جديدة

## 🛠️ خطوات استكشاف الأخطاء المتقدمة

### 1. فحص Firebase
```bash
# اختبار اتصال Firebase
dart test_join_room.dart test 123456 "اختبار"
```

### 2. فحص الغرف المتاحة
```bash
# عرض جميع الغرف المتاحة
dart test_join_room.dart list
```

### 3. اختبار شامل
```bash
# إنشاء غرفة واختبار الانضمام وحذفها
dart test_join_room.dart full
```

## 📱 استكشاف الأخطاء من التطبيق

### الأزرار المساعدة:
1. **الغرف المتاحة** (برتقالي): يعرض جميع الغرف القابلة للانضمام
2. **تنظيف** (بنفسجي): يحذف الغرف الفارغة والقديمة
3. **تشخيص سريع** (أزرق): يفحص النظام ويحدد المشاكل

## 🔄 خطوات الحل التدريجية

### المستوى 1: فحص أساسي
1. تأكد من اتصال الإنترنت
2. تحقق من كود الغرفة (6 أرقام)
3. تأكد من أن اسم اللاعب ليس فارغاً

### المستوى 2: فحص متوسط
1. اضغط على "تشخيص سريع"
2. اضغط على "الغرف المتاحة"
3. جرب إنشاء غرفة جديدة

### المستوى 3: فحص متقدم
1. شغل `dart quick_diagnostic.dart`
2. راجع قواعد Firestore
3. تحقق من إعدادات Firebase

## 📞 طلب المساعدة

إذا استمرت المشكلة بعد تجربة الحلول أعلاه:
1. شغل `dart quick_diagnostic.dart` واحفظ النتائج
2. التقط لقطات شاشة من رسائل الخطأ
3. تواصل مع المطور مع إرفاق:
   - نتائج التشخيص
   - لقطات الشاشة
   - وصف المشكلة

## 🔧 أدوات إضافية

### تنظيف الغرف القديمة
```bash
# حذف جميع الغرف الفارغة والقديمة
dart test_join_room.dart cleanup
```

### اختبار اتصال Firebase
```bash
# اختبار الاتصال فقط
dart test_join_room.dart test-connection
``` 